\chapter{Paralelizace}

Buď $ A $ celočíselná matice $ n \times m $ a předpokládejme, že $ n < m $. Pak
z Hadamardovy nerovnosti (pro bližší informace čtenáře odkazujeme na publikaci
\cite{Hadamard}) plyne, že pro libovolný minor $ h $ matice $ A $
platí $ h \leq (m^{1/2} \Vert A \Vert )^m $, kde
$ \Vert A \Vert = max \{ |a^i_j| \} $. Z článku \cite{Had_tight} plyne, že
Hadamardův odhad je poněkud pesimistický a v případě náhodných matic vychází
determinant v průměru menší, přesto však tento odhad dává tušit, že
se v případě počítačové implementace algoritmu pro výpočet Smithova normálního
tvaru můžeme poměrně rychle dostat do problémů s kapacitou celočíselných typů.

Tento problém můžeme řešit knihovnami pro reprezentaci celých čísel libovolné
bitové délky. Nicméně
efektivita takového řešení už není ideální a navíc tento přístup zvyšuje
paměťovou náročnost. Hodilo by se nám proto, kdybychom mohli celý výpočet
rozložit na více částí, pro které už by nebylo problém spočítat výsledek pomocí
standardní 32-bitové aritmetiky a následně všechny částečné výsledky spojit
do hledaného Smithova normálního tvaru. Toho můžeme dosáhnout pomocí Čínské
zbytkové věty.


\begin{vet}[Čínská zbytková věta] \label{Chin_Rem}
Mějme kladná celá čísla $ m_1,\dots,m_k $, která jsou po dvou nesoudělná. Pak
pro libovolnou posloupnost celých čísel $ a_1,\dots,a_k $ existuje celé
číslo $ x $, které je řešením následující soustavy kongruencí.

\begin{equation}
    \begin{aligned} \label{congrs}
        x &\equiv a_1 \pmod{m_1}                   \\
        x &\equiv a_2 \pmod{m_2}                   \\
          &\mathrel{\makebox[\widthof{=}]{\vdots}}  \\
        x &\equiv a_k \pmod{m_k}                   \\
    \end{aligned}
\end{equation}
%
Navíc pro libovolná dvě řešení $ x_1, x_2 $ uvedené soustavy platí
$ x_1 \equiv x_2 \pmod{m_1 m_2 \cdots m_k} $  .
\end{vet}

\begin{proof}
Zaměřme svou pozornost nejprve na existenci řešení. Označme
$ m = m_1 m_2 \cdots m_k $. Pak zřejmě pro každé $ i \in \{1,\dots,k\} $
platí $ \gcd(m_i, m / m_i) = 1 $, protože $ m_i $ jsou po dvou nesoudělná.
Díky tomu můžeme pomocí rozšířeného Euklidova algoritmu najít celá čísla
$ s_i, t_i $ taková, že $ s_i m_i + t_i \frac{m}{m_i} = 1 $. Nyní označme
$ d_i = t_i \frac{m}{m_i} $. Z toho plyne rovnost $ s_i m_i + d_i = 1 $ a
\begin{align*}
d_i \equiv
\left\{
  \begin{array}{lr}
    1 \pmod{ m_j } & : j = i \\
    0 \pmod{ m_j }  & : j \neq i
  \end{array}
\right.
\end{align*}
Skutečně, pokud $ j = i $, tak dostáváme
$ 1 \equiv s_i m_i + d_i \equiv d_i \pmod{m_i} $. Pokud naopak $ j \neq i $, pak
zřejmě $ m_j \mid d_i $, a proto bude $ d_i $ kongruentní s nulou modulo $ m_j $.

Položme $ x = \sum\limits_{i = 1}^{k} a_i d_i $. Pak díky výše uvedené
vlastnosti $ d_i $ bude $ x $ řešením soustavy \eqref{congrs}.

Nechť $ x_1, x_2 \in \Zbb $ jsou dvě libovolná řešení soustavy \eqref{congrs}.
Pak ale $ x_1 \equiv x_2 \pmod{m_i} $, což implikuje $ m_i \mid x_1 - x_2 $.
Protože $ m_i $ jsou po dvou nesoudělná, tak z předchozí implikace dále plyne, že
$ x_1 - x_2 $ bude dělitelné také součinem všech $ m_i $, tedy
$ m \mid x_1 - x_2 $. To je ale ekvivalentní tomu, že
$ x_1 \equiv x_2 \pmod{m} $ a důkaz je hotov.
\end{proof}

\begin{dus} \label{Chin_Rem_Iso}
Mějme kladné číslo $ m $ s faktorizací $ m = p_1^{r_1} \cdots p_k^{r_k}$. Pak
existuje izomorfismus okruhů
$ \Zbb / m \Zbb \cong \Zbb / p_1^{r_1} \Zbb \times \cdots \times \Zbb / p_k^{r_k} \Zbb $.
\end{dus}
\begin{proof}
Uvažme zobrazení
$ \varphi : \Zbb / m \Zbb \rightarrow \Zbb / p_1^{r_1} \Zbb \times \cdots \Zbb / p_k^{r_k} \Zbb $
definované jako $ \varphi([x]_m) = ([x]_{p_1^{r_1}},\dots, [x]_{p_k^{r_k}}) $.
Ukážeme, že takto definované zobrazení je izomorfismem okruhů.

Mějme libovolný prvek
$ a = ([a_1]_{p_1^{r_1}},\dots, [a_k]_{p_k^{r_k}}) \in \Zbb / p_1^{r_1} \Zbb \times \cdots \Zbb / p_k^{r_k} \Zbb $.
Pak podle věty \ref{Chin_Rem} můžeme nalézt takové $ x \in \Zbb $, že
%
\begin{equation*}
    \begin{aligned}
        x &\equiv a_1 \pmod{p_1^{r_1}}              \\
          &\mathrel{\makebox[\widthof{=}]{\vdots}}  \\
        x &\equiv a_k \pmod{p_k^{r_k}}.           \\
    \end{aligned}
\end{equation*}
%
Pak ale $ \varphi([x]_m) = a $, z čehož plyne, že $ \varphi $ je surjektivní.

Mějme $ x, y \in \Zbb / m \Zbb $ libolná a předpokládejme
$ \varphi(x) = \varphi(y) $. Pak ale z věty \ref{Chin_Rem} plyne, že
$ x \equiv y \pmod{m} $. $ \varphi $ je proto injekce a díky předchozímu
odstavci také bijekce.

Nakonec ještě ověříme, že se skutečně jedná o homomorfismus okruhů.
Mějme $ x, y \in \Zbb / m \Zbb $ libovolné. Pa
%
\begin{align*}
    \varphi(x + y) &= ([x + y]_{p_1^{r_1}},\dots, [x + y]_{p_k^{r_k}})  \\
                   &= ([x]_{p_1^{r_1}} + [y]_{p_1^{r_1}},\dots, [x]_{p_k^{r_k}} + [y]_{p_k^{r_k}})  \\
                   &= ([x]_{p_1^{r_1}},\dots, [x]_{p_k^{r_k}}) + ([y]_{p_1^{r_1}},\dots, [y]_{p_k^{r_k}}) \\
                   &= \varphi(x) + \varphi(y).
\end{align*}
%
Platnost rovnosti $ \varphi(x \cdot y) = \varphi(x) \cdot \varphi(y) $ se ověří
analogicky. Zobrazení $ \varphi $ je tedy skutečně izomorfismus okruhů a zkoumané
prostory jsou proto izomorfní.
\end{proof}

Předpokládejme, že chceme provádět sérii výpočtů (sčítání, odčítání,
násobení) nad celými čísly a jsme dopředu schopni omezit všechny mezivýsledky nějakým číslem
$ m $. Pak tyto výpočty můžeme ekvivalentně provádět v okruhu $ \Zbb / m \Zbb $.
Avšak z důsledku \ref{Chin_Rem_Iso} plyne, že stejně tak můžeme výpočty provést
paralelně modulo prvočíselné faktory $ m $. V praxi $ m $ obvykle získáme tak,
že postupně přidáváme prvočísla dokud jejich součin není dostatečně velký.
Pak použijeme zobrazení $ \varphi $ z důkazu důsledku \ref{Chin_Rem_Iso},
čímž získáme výchozí reprezentanty v příslušných okruzích součinu okruhů.
Nyní můžeme paralelně aplikovat operace, které potřebujeme provést, a konečně
pomocí konstrukce uvedené v důkazu věty \ref{Chin_Rem} spojíme částečné výsledky
a obdržíme výsledek původní úlohy.


\section{Výběr prvočísel}
Předpokládejme, že máme k dispozici odhad $ \beta $, který omezuje všechny
prvky matic vznikajících v průběhu výpočtu Smithova normálního tvaru. Naším cílem bude
najít prvočísla $ p_1,\dots, p_k $ tak, aby $ \beta < p_1 \cdots p_k $. Zřejmě
bychom mohli postupně brát prvočísla $ 2, 3, 5, 7 \dots $, dokud by uvedená
podmínka nebyla splněna. Takto bychom však dostali prvočísel zbytečně mnoho. Na
druhou stranu chceme, aby tato prvočísla byla dostatečně malá, abychom
si pro rozumně velké matice vystačili se standardní 32-bitovou reprezentací
celého čísla. Co znamená rozumně velká matice, bude zřejmé z následujících řádků.

Rozumný kompromis poskytuje \cite[Lemma 14]{triang}. Autor však tento výsledek
uvádí bez důkazu s odkazem na publikaci, ve které se nám nepodařilo takovéto
tvrzení vůbec najít, a to ani v nějaké obecnější podobě či jako pomocný výsledek
nějakého důkazu. Abychom předešli nejasnostem, dokážeme toto tvrzení v mírně
modifikované podobě pomocí následujícího tvrzení.


\begin{lem}[{\cite[Corollary 3.8]{primes}}] \label{num_primes_src}
Nechť $ \pi(a) = \left\vert \{ p \in \mathbb{P} \vert p \leq a \} \right\vert $. Pak
platí $ 3a / (5 \ln{a}) < \pi(2a) - \pi(a) $ pro všechna $ a \geq 20 \frac{1}{2} $.
\end{lem}

\begin{lem} \label{num_prim}
Buď $ x \geq 2 $ a $ l = 6 + \log_2 \log_2 x $.
Pak existuje nejméně $ \ceil{\frac{2^{l}}{5 (l - 1)}} $ prvočísel $ p $
takových, že $ 2^{l - 1} < p < 2^l $.
\end{lem}
\begin{proof}
Dosazením $ a = 2^{l - 1} $ do lemmatu \ref{num_primes_src} a postupnými úpravami
dostáváme
\begin{align*}
    \pi(2^{l}) - \pi(2^{l - 1}) > \frac{3 \cdot 2^{l - 1}}{5 \ln{2^{l - 1}}}
                                \geq \frac{2^{l}}{5 \log_2{2^{l - 1}}}
                                = \frac{2^{l}}{5 (l - 1)}.
\end{align*}
Použití lemmatu \ref{num_primes_src} je skutečně korektní, neboť
$ l \geq 6 $, z čehož plyne, že $ a \geq 32 $. Z definice funkce $ \pi(a) $ pak
získáme naše tvrzení.
\end{proof}
\begin{dus}
Buď $ \beta = (m^{1/2} \Vert A \Vert )^m $ Hadamardův odhad na determinant tak
jako na začátku této sekce a nechť $ l = 6 + \log_2 \log_2 \beta $. Pak můžeme najít
$ s = \ceil{\frac{2^{l}}{5 (l - 1)}} $ prvočísel $ \{p_1, \dots, p_s\} $,
která je možno reprezentovat $ l $-bitovým celým číslem, a navíc bude platit
$ \beta < p_1 \cdots p_s $.
\end{dus}
\begin{proof}
Uvažme prvočísla z lemmatu \ref{num_prim} a označme je $ \{p_1, \dots, p_s\} $.
Tato prvočísla můžeme zdola odhadnout $ 2^{l - 1} < p_i $,
z čehož plyne následující výpočet.
\begin{align*}
    p_1 \cdots p_s
        > (2^{l - 1}) ^ s
        \geq 2^{(l - 1) \frac{2^l}{5 (l - 1)}}
        = 2^{\frac{2^{6 + \log_2 \log_2 \beta}}{5}}
        = \beta^{\frac{2^6}{5}} > \beta
\end{align*}
Tím je důkaz hotov až na případ, kdy $ \beta \in \{0, 1\} $. Tyto možnosti ale
nejsou příliš zajímavé, neboť v prvním případě je Smithův normální tvar nulová
matice a ve druhém pak skalár - jednička. V obou případech pak můžeme vzít
libovolné prvočíslo, které jistě bude větší než determinant.
\end{proof}

\begin{pozn}
Poznamenejme, že v praxi pro nějakou konkrétní úlohu můžeme mít k dispozici
podstatně lepší odhad na determinant nebo na prvky v hledaném Smithově normálním
tvaru. Uvedený postup pak bude fungovat úplně stejně, jen nahradíme $ \beta $
daným odhadem a dále postupujeme identicky.
\end{pozn}

Předpokládejme, že chceme vypočítat Smithův normální tvar matice o rozměrech
$ 10^4 \times 10^4 $. Pak nám budou pro výpočet stačit prvočísla, jejichž bitová
délka bude $ l = 6 + \log_2(10^4 \log_2(10^2 \Vert A \Vert)) $. Pokud dosadíme
například $ \Vert A \Vert = 2^{31} $, zjistíme, že by nám stačila prvočísla
mající nejvýše $ 26 $ bitů, což je pro naše potřeby naprosto
postačující. Předpokládáme, že matice větších rozměrů již budou nad naše výpočetní
možnosti.



\section{Omezení velikosti mezivýsledků}
Abychom mohli aplikovat předchozí výsledky na algoritmy pro výpočet Smithova
normálního tvaru, musíme být schopni omezit prvky všech matic, se kterými
budeme v průběhu výpočtu pracovat. Z článku \cite{triang} vyplývá, že pokud
vhodným způsobem modifikujeme algoritmy ze druhé kapitoly, pak jsme schopni
garantovat, že mezivýsledky budou omezeny výrazem
$ \beta = 2[\Vert A \Vert (20 r \log_2{ (r^{1/2} \Vert A \Vert) })^{5/2} (r^{1/2} \Vert A \Vert)^{9 r} ] + 1 $
\cite[Theorem 16]{triang}.
Ačkoliv tento výraz vypadá poněkud komplikovaně, tak odhad
asymptoticky odpovídá Hadamardovu odhadu na determinant a můžeme psát
$ \log{\beta} = \mathcal{O}(r \log{(r \Vert A \Vert)}) $.
Poznamenejme, že zmíněné modifikace spočívají vesměs v tom, že pomocí nějakého
význačného prvku redukujeme ostatní prvky v řádku nebo sloupečku.

V článku \cite{SNF_Arne} se autor touto problematikou bohužel nezabývá. Pokusíme
se proto pro procedury ze třetí kapitoly podat odhad vlastní. Budeme však muset
mírně upravit požadavky na vstupní matice. Tyto požadavky jsou obsahem následující
definice.

\begin{defi}
    Řekneme, že matice $ A \in \Zmat $ je diagonálně dominantní, jestliže
    splňuje následující podmínky:
    \begin{Cond}
        \item Hlavní $ n \times n $ submatice je horní trojúhelníková, má plnou
            hodnost a prvky na diagonále jsou kladné.
        \item Pro každé $ 1 \leq i \leq n $ a $ i < j \leq m $ platí $ A[i, i] > A[i, j] \geq 0 $.
    \end{Cond}
\end{defi}

Pro další práci s ohady budeme ještě potřebovat následující lemma.
\begin{lem} \label{bez_bound}
Nechť $ a, b \in \Zbb $. Pak existují koeficienty
$ s, t $, $ \gcd(a, b) = s a + t b $ takové, že platí $ |s| \leq |b| $ a
$ |t| \leq |a| $.
\end{lem}
\begin{proof}
Bez újmy na obecnosti můžeme předpokládat, že $ \gcd(a, b) = 1 $ a $ 1 < a < b $.
Nechť $ s, t $ jsou koeficienty získané aplikací rozšířeného Euklidova algoritmu
na dvojici $ a, b $. Pak platí $ a p + b t = 1 $. Zavedeme substituci
$ s \leftarrow s - k b $ a $ t \leftarrow t + k a $, kde $ k $ je celé číslo takové, že
$ |t + k a| \leq a $. Nové koeficienty $ s,t $ budou splňovat stejnou rovnost
jako ty původní, ale navíc bude platit $ |t| \leq a $. Z toho plynou následující
nerovnosti.
\begin{equation*}
    a |s| = | 1 - bt | \leq 1 + |bt| \leq 1 + |ab| < a(1 + b)
\end{equation*}
Z toho pak plyne, že $ |s| < 1 + b $ a $ |s| \leq b $.
\end{proof}
\begin{pozn}
Dá se ukázat, že koeficienty z rozšířeného Euklidova algoritmu budou mít přesně
vlastnosti, které požaduje lemma \ref{bez_bound}.
\end{pozn}



\begin{lem}
Existuje algoritmus, který převede libovolnou matici v redukovaném schodovitém
tvaru na ekvivalentní matici, která bude diagonálně dominantní.
\end{lem}



\begin{lem} \label{Sloup_elim_GCD_modified}
Buď $ T $ diagonálně dominantní matice splňující požadavky lemmatu \ref{Sloup_elim_GCD}.
Pak můžeme algoritmus lemmatu \ref{Sloup_elim_GCD} modifikovat tak, že všechny
mezivýsledky budou omezeny výrazem $ a_{k - 2} a_{k - 1} $ 
a výsledná matice bude diagonálně dominantní.
\end{lem}
\begin{proof}
Jediná operace inkriminovaného algoritmu, která zvětšuje prvky matice $ T $ je
je v $ i $-té iteraci přičtení $ c $-násobku řádku: 
$ \operatorname{row}(T, i) \pluseq c \operatorname{row}(T, i + 1) $.

Z Bachova lemmatu \ref{bach} plyne, že $ 0 \leq c < a_i $. To pak společně s
tím, že $ T $ je diagonálně dominantní, implikuje $ a_i a_{i+1} > T[i, j] $ pro
$ j = 1, \dots, m $. Z toho plyne, že všechny mezivýsledky můžeme omezit výrazem
$ \max\limits_{1 \leq i < k - 1}\{ a_i a_{i+1} \} $. Avšak z vlastností Smithova
normální tvaru plyne, že maximum bude rovno $ a_{k - 2} a_{k - 1} $.

Navíc pak pomocí prvku
$ a_i $ můžeme zredukovat všechny prvky napravo, čímž získáme diagonálně dominantní
matici. Korektnost algoritmu zůstane zachována, neboť platí
$ \gcd(a_i, t_{i} + ct_{i+1}) = \gcd(a_i, t_{i} + ct_{i+1} + k a_i) $,
kde $ k $ je libovolné celé číslo.
\end{proof}




\begin{lem}\label{Sloup_elim_SNF_modified}
Buď $ T $ diagonálně dominantní matice splňující požadavky lemmatu \ref{Sloup_elim_SNF}.
Pak můžeme algoritmus lemmatu \ref{Sloup_elim_SNF} modifikovat tak, že všechny
mezivýsledky budou omezeny výrazem 
$ \max\{ |t_k a_1|, a_1 a_{k - 1} \}  $ 
a výsledná matice bude diagonálně dominantní.
\end{lem}
\begin{proof}
V algoritmu lemmatu \ref{Sloup_elim_SNF} zvětšujeme velikost prvků matice $ T $
pouze při jejím vynásobením maticí $ V $. Vynásobení bude mít vliv pouze na
prvky hlavní submatice $ k \times k $. Výslednou submatici můžeme zapsat ve tvaru

\begin{align*}
    \left(
    \begin{array}{ccccc}
        s_1        &     &        &         &                 \\
        tt_2       & a_2 &        &         & t_2 a_1/s_1     \\
        \vdots     &     & \ddots &         & \vdots          \\
        tt_{k - 1} &     &        & a_{k-1} & t_{k-1} a_1/s_1 \\
        tt_k       &     &        &         & t_k a_1/s_1     \\
    \end{array}
    \right)
.
\end{align*}

Prvek na pozici $ [1,1] $ se ze zřejmých důvodů určitě nezvětší. Pokud za $ s, t $
zvolíme koeficienty z lemmatu \ref{bez_bound}, tak bude platit $ |t| \leq a_1 $.
Pro prvky $ t t_i $ z prvního sloupečku matice $ TV $ proto bude platit
$ |t t_i| \leq a_1 a_i $, protože vstupní matice $ T $ je diagonálně dominantní.
Pro prvek máme $ |t t_k| \leq |a_1 t_k| $.

A konečně pro prvky $ k $-tého sloupčeku dostáváme odhady
\begin{align*}
|t_i a_1 / s_1| \leq a_1 a_i \leq \max\limits_{1 < i < k }\{ a_1 a_{i} \} = a_1 a_{k - 1}
\end{align*}
a $ |t_k a_1 / s_1| \leq |a_1 t_k| $.

Po eliminaci prvků pod diagonálou v prvním sloupečku zbývá zajistit, že
výsledná matice bude diagonálně dominantní. To provedeme redukcí
prvků napravo od diagonály diagonálními prvky. Ověříme, zda budou splněny
podmínky kladené lemmatem \ref{Sloup_elim_SNF} na výslednou matici.
Na splnění podmínek (c1) a (c2) nemá naše modifikace algoritmu žádný vliv.
Podmínka (c3) bude splněna díky stejné argumentaci jako v případě lemmatu
\ref{bez_bound}.

Z lemmatu \ref{Sloup_elim_SNF} plyne, že $ s_1 \vert (t_i a_1/s_1) $ pro
$ i = 2, \dots, k $. Avšak z podmínky (c2) dostáváme, že také $ s_1 \vert a_i $.
Proto $ s_1 \vert (t_i a_1/s_1 + k a_i) $ a podmínka (c4) je splněna. (c5) bude splněna
triviálně.
\end{proof}


\begin{lem} \label{Sloup_elim_modified}
Buď $ T $ diagonálně dominantní matice splňující požadavky věty \ref{Sloup_elim}.
Pak můžeme algoritmus věty \ref{Sloup_elim} modifikovat tak, že všechny
mezivýsledky budou omezeny výrazem $ a_1 \cdots a_{k - 1} |t_k|$ 
a výsledná matice bude diagonálně dominantní.
\end{lem}
\begin{proof}
Pro modifikaci algoritmu věty \ref{Sloup_elim} můžeme použít algoritmy z lemmat
\ref{Sloup_elim_GCD_modified} a \ref{Sloup_elim_SNF_modified}. Jejich výstupem
je vždy diagonálně dominantní matice, takže jejich použití je korektní.

Lemma \ref{Sloup_elim_GCD_modified} dává odhad $ a_{k - 2} a_{k - 1} $. 
Následně budeme iterativně aplikovat lemma \ref{Sloup_elim_SNF_modified}.
Pro $ i $-tou iteraci máme odhad $ \max\{ |T[k,k] a_i|, a_i a_{k - 1} \} $,
kde $ T[k,k] $ je prvek na pozici $ [k, k] $, který se bude v průběhu výpočtu
měnit. Poznamenejme, že na začátku výpočtu platí $ T[k,k] = t_k $. V $ i $-té 
iteraci přiřazujeme $ T[k,k] = T[k,k] a_i / s_i $, kde $ s_i $ odpovídá prvku
v příslušné iteraci, který jsme v lemmatu \ref{Sloup_elim_SNF} značili $ s_1 $.
V nejhorším případě bude $ s_i = 1 $ pro $ i = 1, \dots, k - 1 $. V každé iteraci 
proto bude platit $ |T[k,k] a_i| \leq |t_k| a_1 \cdots a_{k - 1} $. 

Největší z uvedených odhadů bude zřejmě odhad $ |t_k| a_1 \cdots a_{k - 1} $,
čímž je tvrzení dokázáno.
\end{proof}


\begin{lem} \label{Zero_extra_modified}
Buď $ T $ diagonálně dominantní matice splňující požadavky věty \ref{Zero_extra}.
Pak můžeme algoritmus věty \ref{Zero_extra} modifikovat tak, že všechny
mezivýsledky budou omezeny výrazem $ a_k + a_{k - 1} a_k $ 
a navíc transpozice výsledné matice bude diagonálně dominantní.
\end{lem}
\begin{proof}
V každé iteraci algoritmu věty \ref{Zero_extra} můžeme podle lemmatu
\ref{bez_bound} zvolit koeficienty $ s, t $ tak, že $ |s| \leq |b_{1,j}| \leq a_1$
a $ |t| \leq a_1 $. Po aplikaci transformační matice $ V $ dostáváme matici ve
tvaru
\begin{align*}
TV =
    \left(
    \begin{array}{cccc|ccccccc}
        s_1      &     &        &     & b_{1,1} & \hdots & b_{1,j-1} &                   & b_{1,j+1} & \hdots & b_{1,m-k} \\
        tb_{2,j} & a_2 &        &     & b_{2,1} & \hdots & b_{2,j-1} & b_{2,j} a_1 / s_1 & b_{2,j+1} & \hdots & b_{2,m-k} \\
        \vdots   &     & \ddots &     & \vdots  &        & \vdots    & \vdots            & \vdots    &        & \vdots    \\
        tb_{k,j} &     &        & a_k & b_{k,1} & \hdots & b_{k,j-1} & b_{k,j} a_1 / s_1 & b_{k,j+1} & \hdots & b_{k,m-k} \\
    \end{array}
    \right).
\end{align*}
Jediné prvky, které se můžou transformací zvětšit jsou ty pod diagonálou v 
prvním sloupci a prvky $ b_{i,j} $ pro $ i = 2,\dots,k $.

Díky tomu, že matice $ T $ je diagonálně dominantní, platí nerovnost
$ |tb_{i,j}| \leq a_1 a_i $ pro $ i = 2,\dots,k $. Také zřejmě platí
$ | b_{i,j} a_1 / s_1 | \leq a_1 a_i $. Následně můžeme všechny prvky redukovat
modulo příslušný diagonální prvek.

Tento eliminační proces můžeme provést pro všechny prvky $ b_{1, j} $ se stejnými
odhady na pracovní prvky. Jen odhad na prvky v prvním sloupci musíme mírně upravit.
Označme prvky prvního sloupce v průběhu výpočtu $ t_i $. Pak po každé iteraci
eliminačního procesu bude zřejmě platit $ |t_i| \leq |a_i| $. V každém kroku
algoritmu tak bude platit $ |t_i| \leq a_i + a_1 a_i $, neboť při eliminaci
prvku $ b_{1,j} $ přiřazujeme $ t_i = t_i + tb_{i,j} $.

Celkem jsme tedy schopni eliminovat všechny prvky $ b_{1,j} $ tak, že  
mezivýsledky budou omezeny výrazem $ \max\{ a_i + a_1 a_i \} $, kde 
$ i = 2,\dots,k $. Nakonec ještě redukujeme prvky pod diagonálou modulo 
diagonální prvek ve stejném sloupečku.

Stejný postup můžeme aplikovat rekurzivně na trailing
$ (k - i + 1) \times (m - i + 1) $ submatici pro $ i = 2,\dots, k $. Tímto 
způsobem dostaneme matici požadovaného tvaru. Velikost mezivýsledků bude 
díky předchozímu omezena výrazem 
$ \max\limits_{1 \leq q < i \leq k}\{ a_i + a_q a_i \} = a_k + a_{k - 1} a_k $.
Uvedená rovnost plyne z vlastností Smithova normálního tvaru. 

Díky tomu, že jsme sloupce v hlavní $ k \times k $ matici průběžně redukovali
modulo diagonální prvek, bude transpozice výsledné matice diagonálně dominantní.
\end{proof}

\begin{vet}
Buď $ A $ diagonálně dominantní matice splňující požadavky věty \ref{SNF_Triang}.
Označme diagonální prvky matice $ A $ postupně $ a_1, a_2, \dots, a_n $.
Pak můžeme algoritmus věty \ref{SNF_Triang} modifikovat tak, že všechny
mezivýsledky budou omezeny výrazem $ 2 a_1 a_2 \cdots a_n $.
\end{vet}
\begin{proof}
Nejprve modifikuje první fázi algoritmu věty \ref{Sloup_elim} o sloupcové 
eliminaci. Z lemmatu \ref{Sloup_elim_modified} plyne, že stávající proceduru 
můžeme nahradit její vylepšenou verzí, která dává záruky na velikost prvků. 
Snadno se nahlédne, že  algoritmus z \ref{Sloup_elim_modified} nemění absolutní 
hodnotu součinu  diagonálních prvků vstupní matice. Z toho důvodu budou 
mezivýsledky v  každém kroku $ r \in \{1, \dots, n \} $ omezeny součinem 
$ |a_1 \cdots a_r| $.
Výsledkem bude ekvivalentní matice
\begin{align*}
A' =
    \left(
    \begin{array}{c|c}
        S' & B
    \end{array}
    \right)
.
\end{align*}
Z lemmatu \ref{Sloup_elim_modified} plyne, že matice $ A' $ bude diagonálně
dominantní.

Ve druhé fázi použijeme algoritmus z lemmatu \ref{Zero_extra_modified}
k eliminaci prvků v submatici $ B $. Nechť $ s_i $ značí diagonální prvky matice 
$ S' $. Pak lemma \ref{Zero_extra_modified} garantuje, že všechny mezivýsledky 
budou omezeny součtem $ s_n + s_{n - 1} s_n $. Avšak z toho, že 
$ |a_1 \cdots a_n| = s_1 \cdots s_n $, plyne 
$ s_n + s_{n - 1} s_n \leq 2 s_{n - 1} s_n \leq 2 |a_1 \cdots a_n| $.

Navíc transpozice výsledné $ n \times n $ hlavní submatice bude diagonálně 
dominantní. Díky tomu na ni opět můžeme iterativně aplikovat modifikovaný 
algoritmus sloupcové eliminace s odhadem $ |a_1 \cdots a_n| $.

Maximum odhadů ze všech tří částí je rovno $ 2 |a_1 \cdots a_n| $, což jsme měli
dokázat.
\end{proof}








\section{Paralelizace algoritmů pro výpočet Smithova normálního tvaru}
Mějme opět matici $ A $ tak jako na začátku a uvažme prvočísla
$ \{ p_1, \dots, p_s \} $ z předchozí sekce. Článek \cite[Theorem 16]{triang}
uvádí, že operace algoritmu z věty \ref{RST_algo} můžeme provádět paralelně
v okruzích $ \Zbb / p_i \Zbb $. Avšak autor také podotýká, že aby byl algoritmus
korektní, musíme v algoritmu lemmatu \ref{RST_algo_lemma} postupovat poněkud
opatrněji. S pracovní maticí $ B_k $, která označuje právě zpracovávaný sloupec,
bychom měli vždy pracovat pouze ve standardní reprezentaci. To znamená, že při
inicializaci matice $ B_k $ musíme pomocí věty \ref{Chin_Rem} zobrazit příslušné
prvky matic v okruzích $ \Zbb / p_i \Zbb $ do okruhu $ \Zbb / m \Zbb $.

V praxi to pak znamená, že ve chvíli, kdy algoritmus potřebuje vypočítat nějaký
koeficient (například pomocí rozšířeného Euklidova algoritmu), musíme prvky
potřebné pro výpočet daného koeficientu převést z modulárního systému do standardní
reprezentace pomocí Čínské zbytkové věty, vypočítat koeficient nad okruhem celých
čísel a pak pomocí tohoto koeficientu provést kýženou operaci nad maticemi v
okruzích $ \Zbb / p_i \Zbb $.

Autor článku \cite{triang} se
také zabývá tím, jak vypočítat rank profile potřebný pro výpočet redukovaného
schodovitého tvaru pomocí Čínské zbytkové věty. Ukazuje se \cite[Theorem 15]{triang},
že je skutečně možné efektivně rank profile vypočítat pomocí prvočísel $ p_i $
tak, že pracujeme v okruzích $ \Zbb / p_i \Zbb $.
Výpočet ekvivalentní trojúhelníkové matice z matice $ A $ tedy není problém.

Naneštěstí v článku \cite{SNF_Arne} se autor již problematikou počítání v
reziduálním systému nezabývá. To však můžeme na
pravit. Výpočet povedeme podobným
způsobem jako v případě výše uvedené paralelizace algoritmu pro výpočet RST.
Nejprve musíme identifikovat všechna místa algoritmu z věty \ref{SNF_Triang},
která vyžadují výpočet nějakých koeficientů. V lemmatu \ref{Sloup_elim_GCD}
se jedná o koeficient $ c $, který počítáme pomocí Bachova lemmatu. Lemma
\ref{Sloup_elim_SNF} pak používá rozšířený Euklidův algoritmus pro výpočet čísel
$ s, t $ a $ s_1 $. Analogický výpočet koeficientů $ s, t $ najdeme v lemmatu
\ref{extra_cols}. Na těchto třech místech proto musí dojít k synchronizaci výpočtu,
převodu příslušných prvků do standardní reprezentace, výpočtu potřebných
koeficientů a pak teprve může algoritmus pokračovat ve výpočtu v modulárních
systémech se získanými koeficienty.

Celkem tedy dostáváme algoritmus pro výpočet Smithova normálního tvaru, který
je schopen provádět většinu výpočtů ve standardní 32-bitové aritmetice. Navíc části
algoritmu, které nevyžadují výpočet zmíněných koeficientů, můžeme provádet
paralelně a využít tak plný potenciál dnešních vícejádrových procesorů.
V místě, kde je potřeba udělat nějaké rozhodnutí (vypočítat koeficient),
je nutné pracovat s datovými typy pro reprezentaci libovolně velkého celého
čísla. V jednom okamžiku však takových čísel budeme potřebovat jen velmi málo
(obvykle se jedná pouze o vstupy do rozšířeného Euklidova algoritmu), a proto
tyto výpočty nebudou nijak významně zvyšovat paměťovou náročnost.
